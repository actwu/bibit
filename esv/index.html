<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ESV Bible PWA</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="theme-color" content="#000000">
<link rel="manifest" href="manifest.json">
<style>
body{font-family:sans-serif;text-align:center;padding:2em;background:#000;color:#fff;}
button{padding:1em 2em;font-size:1rem;background:#3367D6;color:white;border:none;border-radius:6px;margin-top:1em;cursor:pointer;}
select{padding:0.6em;margin:1em 0;background:#111;color:#fff;border:1px solid #333;border-radius:4px;}
.verse{margin:1em 0;text-align:left;}
.word{margin-right:0.3em;display:inline-block;}
</style>
</head>
<body>
<div id="install-ui" style="display:none;">
<h1>Install This App</h1>
<button id="install-btn">Install</button>
</div>
<div id="app-ui" style="display:none;">
<h1>ESV Bible Reader</h1>
<select id="book-select"></select>
<div id="verses">Loading...</div>
</div>
<script>
let deferredPrompt;
const isStandalone=window.matchMedia('(display-mode: standalone)').matches||window.navigator.standalone;
const isInstalled=localStorage.getItem('pwaInstalled')==='true';
const installUI=document.getElementById('install-ui');
const appUI=document.getElementById('app-ui');
const installBtn=document.getElementById('install-btn');
const showInstallUI=()=>{installUI.style.display='block';appUI.style.display='none';}
const showAppUI=()=>{installUI.style.display='none';appUI.style.display='block';}
const handleInstall=()=>{if(deferredPrompt){deferredPrompt.prompt();deferredPrompt=null;}};
installBtn.addEventListener('click',handleInstall);
window.addEventListener('beforeinstallprompt',(e)=>{e.preventDefault();deferredPrompt=e;if(!isStandalone)showInstallUI();});
window.addEventListener('appinstalled',()=>{localStorage.setItem('pwaInstalled','true');location.reload();});
if(isStandalone){showAppUI();loadBible();}else{showInstallUI();}
async function loadBible(){try{const res=await fetch('https://actwu.github.io/api/ESV.json');const data=await res.json();bibleData=data.books;populateBooks();}catch(e){document.getElementById('verses').textContent='Failed to load Bible.';}}
const bookSelect=document.getElementById('book-select');const versesDiv=document.getElementById('verses');let bibleData={};
function populateBooks(){bookSelect.innerHTML='';const books=Object.keys(bibleData);books.forEach(book=>{const opt=document.createElement('option');opt.value=book;opt.textContent=book;bookSelect.appendChild(opt);});displayChapters();}
function displayChapters(){const book=bookSelect.value;const chapters=bibleData[book];versesDiv.innerHTML=`<h2>${book}</h2>`;chapters.forEach((chapter,ci)=>{const chTitle=document.createElement('h3');chTitle.textContent=`Chapter ${ci+1}`;versesDiv.appendChild(chTitle);chapter.forEach((verse,vi)=>{const verseEl=document.createElement('div');verseEl.classList.add('verse');const vNum=document.createElement('strong');vNum.textContent=`${vi+1} `;verseEl.appendChild(vNum);verse.forEach(word=>{const w=document.createElement('span');w.className='word';w.textContent=word[0];verseEl.appendChild(w);});versesDiv.appendChild(verseEl);});});}
bookSelect.addEventListener('change',displayChapters);
</script>
</body>
</html>
